<!DOCTYPE html>
<html>
<head>
    <title>Sensor de Tensión en Tiempo Real</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .chart-container {
            width: 100%;
            height: 500px;
            margin: 20px 0;
        }
        .value-display {
            font-size: 24px;
            text-align: center;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Monitor de Tensión en Tiempo Real</h1>
        <div id="value-display" class="value-display"></div>
        <div id="tension-chart" class="chart-container"></div>
    </div>

    <script>
        // Configuración del gráfico
        let trace = {
            x: [],
            y: [],
            mode: 'lines',
            name: 'Tensión'
        };

        let layout = {
            title: 'Tensión vs Tiempo',
            xaxis: { title: 'Tiempo' },
            yaxis: { title: 'Tensión (kg)' },
            shapes: [
                // Zona verde (0-1000)
                {
                    type: 'rect',
                    xref: 'paper',
                    yref: 'y',
                    x0: 0,
                    y0: 0,
                    x1: 1,
                    y1: 1000,
                    fillcolor: 'rgba(0,255,0,0.1)',
                    line: { width: 0 }
                },
                // Zona amarilla (1000-1500)
                {
                    type: 'rect',
                    xref: 'paper',
                    yref: 'y',
                    x0: 0,
                    y0: 1000,
                    x1: 1,
                    y1: 1500,
                    fillcolor: 'rgba(255,255,0,0.1)',
                    line: { width: 0 }
                },
                // Zona roja (>1500)
                {
                    type: 'rect',
                    xref: 'paper',
                    yref: 'y',
                    x0: 0,
                    y0: 1500,
                    x1: 1,
                    y1: 2000,
                    fillcolor: 'rgba(255,0,0,0.1)',
                    line: { width: 0 }
                }
            ]
        };

        Plotly.newPlot('tension-chart', [trace], layout);

        function updateData() {
            fetch('/get_data')
                .then(response => response.json())
                .then(data => {
                    // Actualizar el valor actual
                    const valueDisplay = document.getElementById('value-display');
                    const value = data.current_value;
                    
                    // Cambiar el color según el valor
                    let backgroundColor;
                    if (value <= 1000) {
                        backgroundColor = 'rgba(0,255,0,0.2)';
                    } else if (value <= 1500) {
                        backgroundColor = 'rgba(255,255,0,0.2)';
                    } else {
                        backgroundColor = 'rgba(255,0,0,0.2)';
                    }
                    
                    valueDisplay.style.backgroundColor = backgroundColor;
                    valueDisplay.textContent = `Tensión actual: ${value.toFixed(2)} kg`;

                    // Actualizar el gráfico
                    Plotly.update('tension-chart', {
                        x: [data.historical_data.timestamps],
                        y: [data.historical_data.values]
                    });
                })
                .catch(error => console.error('Error:', error));
        }

        // Actualizar cada segundo
        setInterval(updateData, 1000);
        updateData(); // Primera actualización inmediata
    </script>
</body>
</html>
